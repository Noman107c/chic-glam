// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ma/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  password  String
  name      String
  role      UserRole   @default(RECEPTIONIST)
  phone     String?
  avatar    String?
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  // Relationships
  transactions    Transaction[]
  beauticianInfo  Beautician?
  employeeInfo    Employee?
  attendanceLogs  AttendanceLog[]
  leaveRequests   LeaveRequest[]

  @@map("users")
}

enum UserRole {
  SUPER_ADMIN
  RECEPTIONIST
  BEAUTICIAN
  MANAGER
  STAFF
  HR
}

model Beautician {
  id              String   @id @default(cuid())
  userId          String   @unique
  specialization  String[]
  experience      Int      // in years
  rating          Float    @default(5.0)
  isAvailable     Boolean  @default(true)
  hourlyRate      Float    @default(0)
  totalEarnings   Float    @default(0)
  servicesCount   Int      @default(0)

  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  appointments    Appointment[]
  transactionItems TransactionItem[]

  @@map("beauticians")
}

model Service {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  category    String
  duration    Int      // in minutes
  price       Float
  isActive    Boolean  @default(true)
  image       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  transactionItems TransactionItem[]
  appointments     Appointment[]

  @@map("services")
}

model Product {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  category    String
  price       Float
  quantity    Int      @default(0)
  reorderLevel Int     @default(10)
  supplier    String?
  image       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  transactionItems TransactionItem[]
  inventoryLogs    InventoryLog[]

  @@map("products")
}

model Appointment {
  id              String    @id @default(cuid())
  customerId      String    @default(cuid())
  customerName    String
  customerPhone   String?
  customerEmail   String?
  
  beauticianId    String?
  serviceId       String
  
  appointmentDate DateTime
  duration        Int       // in minutes
  status          AppointmentStatus @default(SCHEDULED)
  notes           String?
  isWalkIn        Boolean   @default(false)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  beautician      Beautician? @relation(fields: [beauticianId], references: [id])
  service         Service   @relation(fields: [serviceId], references: [id])

  @@map("appointments")
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

model Transaction {
  id              String    @id @default(cuid())
  transactionNo   String    @unique
  
  customerId      String    @default(cuid())
  customerName    String
  customerPhone   String?
  
  receptionistId  String
  
  subtotal        Float     @default(0)
  discount        Float     @default(0)
  discountType    String    @default("percentage") // percentage or fixed
  tax             Float     @default(0)
  total           Float
  paid            Float     @default(0)
  balance         Float     @default(0)
  
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   PaymentMethod
  
  notes           String?
  appointmentId   String?
  couponId        String?
  membershipId    String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  receptionist    User      @relation(fields: [receptionistId], references: [id], onDelete: Restrict)
  items           TransactionItem[]
  payments        Payment[]
  coupon          Coupon?   @relation(fields: [couponId], references: [id])
  membership      MembershipCard? @relation(fields: [membershipId], references: [id])
  receipt         Receipt?

  @@map("transactions")
}

model Receipt {
  id              String    @id @default(cuid())
  receiptNumber   String    @unique
  transactionId   String    @unique
  
  businessName    String    @default("Chic & Glam")
  businessPhone   String?
  businessEmail   String?
  businessAddress String?
  businessLogo    String?
  
  customerName    String
  customerPhone   String?
  customerEmail   String?
  
  cashierName     String
  
  items           Json      // Store item details as JSON
  subtotal        Float
  discount        Float
  discountPercent Float     @default(0)
  tax             Float
  total           Float
  paid            Float
  change          Float     @default(0)
  
  paymentMethod   PaymentMethod
  paymentStatus   PaymentStatus
  
  notes           String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  transaction     Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@map("receipts")
}

model TransactionItem {
  id              String    @id @default(cuid())
  transactionId   String
  
  type            String    // "service" or "product"
  serviceId       String?
  productId       String?
  
  quantity        Int       @default(1)
  duration        Int?      // for services
  unitPrice       Float
  amount          Float
  
  beauticianId    String?   // who provided the service

  transaction     Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  service         Service?  @relation(fields: [serviceId], references: [id])
  product         Product?  @relation(fields: [productId], references: [id])
  beautician      Beautician? @relation(fields: [beauticianId], references: [id])

  @@map("transaction_items")
}

enum PaymentStatus {
  PENDING
  PAID
  PARTIAL
  CANCELLED
}

enum PaymentMethod {
  CASH
  CARD
  ONLINE
  CHEQUE
  GIFT_CARD
}

model Payment {
  id              String    @id @default(cuid())
  transactionId   String
  
  amount          Float
  paymentMethod   PaymentMethod
  tip             Float     @default(0)
  
  reference       String?   // for online/card payments
  status          PaymentStatus @default(PENDING)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  transaction     Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model InventoryLog {
  id              String    @id @default(cuid())
  productId       String
  
  type            String    // "add", "use", "return"
  quantity        Int
  reason          String?
  
  createdAt       DateTime  @default(now())

  product         Product   @relation(fields: [productId], references: [id])

  @@map("inventory_logs")
}

model Coupon {
  id              String    @id @default(cuid())
  code            String    @unique
  
  discountType    String    // "percentage" or "fixed"
  discountValue   Float
  
  minAmount       Float     @default(0)
  maxUses         Int       @default(-1) // -1 for unlimited
  usedCount       Int       @default(0)
  
  validFrom       DateTime
  validUntil      DateTime
  isActive        Boolean   @default(true)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  transactions    Transaction[]

  @@map("coupons")
}

model MembershipCard {
  id              String    @id @default(cuid())
  cardNumber      String    @unique
  
  customerName    String
  customerEmail   String?
  customerPhone   String?
  
  memberType      MemberType @default(STANDARD)
  discountPercent Float     @default(10)
  
  balance         Float     @default(0)
  
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  transactions    Transaction[]

  @@map("membership_cards")
}

enum MemberType {
  STANDARD
  SILVER
  GOLD
  PLATINUM
}

model Employee {
  id              String    @id @default(cuid())
  userId          String    @unique
  
  department      String?
  position        String?
  joinDate        DateTime  @default(now())
  salary          Float?
  
  emergencyContact String?
  emergencyPhone  String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  attendanceLogs  AttendanceLog[]
  leaveRequests   LeaveRequest[]

  @@map("employees")
}

model AttendanceLog {
  id              String    @id @default(cuid())
  userId          String
  employeeId      String
  
  checkInTime     DateTime
  checkOutTime    DateTime?
  
  isLate          Boolean   @default(false)
  isAbsent        Boolean   @default(false)
  overtime        Float     @default(0)  // in minutes
  
  notes           String?
  
  createdAt       DateTime  @default(now())

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  employee        Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("attendance_logs")
}

model LeaveRequest {
  id              String    @id @default(cuid())
  userId          String
  employeeId      String
  
  leaveType       LeaveType
  startDate       DateTime
  endDate         DateTime
  reason          String?
  
  status          LeaveStatus @default(PENDING)
  approvedBy      String?    // userId of approver
  approvedAt      DateTime?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  employee        Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("leave_requests")
}

enum LeaveType {
  SICK
  CASUAL
  EARNED
  UNPAID
  MATERNITY
  PATERNITY
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

model Category {
  id              String    @id @default(cuid())
  name            String    @unique
  description     String?
  icon            String?
  color           String?
  
  isActive        Boolean   @default(true)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@map("categories")
}
